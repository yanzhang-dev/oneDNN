<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN: PReLU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library (oneDNN)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library (oneDNN)</div>
    </a>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
   <div id="projectnumber">2.1.3</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dev_guide_prelu.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PReLU </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p></p>
<p><a class="el" href="group__dnnl__api__prelu.html">API Reference</a></p>
<p></p>
</blockquote>
<h2>General</h2>
<p>The PReLU primitive (Leaky ReLU with trainable alpha parameter) performs forward or backward operation on data tensor. Weights (alpha) tensor supports broadcast-semantics. Broadcast configuration is assumed based on src and weights dimensions.</p>
<p>Example broadcasts:</p>
<table class="doxtable">
<tr>
<th>broadcast type </th><th>src dimensions </th><th>weights dimensions  </th></tr>
<tr>
<td>Channel-shared </td><td>\(\{n, c, h ,w\}\) </td><td>\(\{1, 1, 1 ,1\}\) </td></tr>
<tr>
<td>Channel-wise </td><td>\(\{n, c, h ,w\}\) </td><td>\(\{1, c, 1 ,1\}\) </td></tr>
<tr>
<td>Whole-tensor </td><td>\(\{n, c, h ,w\}\) </td><td>\(\{n, c, h ,w\}\) </td></tr>
<tr>
<td>Shared-axes </td><td>\(\{n, c, h ,w\}\) </td><td>\(\{n, 1, h ,1\}\) </td></tr>
</table>
<p>note: Shared-axes indicates broadcast with any combination of shared dimensions.</p>
<h3>Forward</h3>
<p>The PReLU operation is defined by the following formulas. We show formulas only for 2D spatial data which are straightforward to generalize to cases of higher and lower dimensions. Variable names follow the standard <a class="el" href="dev_guide_conventions.html">Naming Conventions</a>. For no broadcast case, results are calculated using formula:</p>
<p class="formulaDsp">
\[ \dst(n, c, h, w) = \begin{cases} \src(n, c, h, w) &amp; \mbox{if } \src(n, c, h, w) &gt; 0 \\ \src(n, c, h, w) \cdot \weights(n, c, h, w) &amp; \mbox{if } \src(n, c, h, w) \leq 0 \end{cases} \]
</p>
<p>Depending on broadcast configuration, result is calculated taking into account shared dimensions of weights tensor.</p>
<h4>Difference Between Forward Training and Forward Inference</h4>
<p>There is no difference between the <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a992e03bebfe623ac876b3636333bbce0" title="Forward data propagation (training mode). ">dnnl_forward_training</a> and <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a2f77a568a675dec649eb0450c997856d" title="Forward data propagation (inference mode). ">dnnl_forward_inference</a> propagation kinds.</p>
<h3>Backward</h3>
<p>The backward propagation computes \(\diffsrc\) and \(\diffweights\). For no broadcast case, results are calculated using formula:</p>
<p class="formulaDsp">
\[ \begin{align} \mbox{diff_src}(n, c, h, w) &amp;= \begin{cases} \mbox{diff_dst}(n, c, h, w) &amp; \mbox{if } \src(n, c, h, w) &gt; 0 \\ \mbox{diff_dst}(n, c, h, w) \cdot \weights(n, c, h, w) &amp; \mbox{if } \src(n, c, h, w) \leq 0 \end{cases}\\\\ \mbox{diff_weights}(n, c, h, w) &amp;= \min(\src(n, c, h, w), 0) \cdot \mbox{diff_dst}(n, c, h, w) \end{align} \]
</p>
<p>Similar to forward propagation, result is calculated taking into account shared dimensions of weights tensor. \(\diffweights\) results are accumulated according to weights tensor shared dimensions, since \(\diffweights\) tensor must match \(\weights\) tensor.</p>
<h2>Execution Arguments</h2>
<p>When executed, the inputs and outputs should be mapped to an execution argument index as specified by the following table.</p>
<table class="doxtable">
<tr>
<th>Primitive input/output </th><th>Execution argument index  </th></tr>
<tr>
<td>\(\src\) </td><td>DNNL_ARG_SRC </td></tr>
<tr>
<td>\(\dst\) </td><td>DNNL_ARG_DST </td></tr>
<tr>
<td>\(\weights\) </td><td>DNNL_ARG_WEIGHTS </td></tr>
<tr>
<td>\(\diffsrc\) </td><td>DNNL_ARG_DIFF_SRC </td></tr>
<tr>
<td>\(\diffdst\) </td><td>DNNL_ARG_DIFF_DST </td></tr>
<tr>
<td>\(\diffweights\) </td><td>DNNL_ARG_DIFF_WEIGHTS </td></tr>
</table>
<h2>Implementation Details</h2>
<h3>General Notes</h3>
<ul>
<li>Prelu primitive requires all input/output tensors to have the same number of dimensions. Dimension sizes can differ however.</li>
<li>\(\weights\) tensor dimensions sizes must follow broadcast semantics. Each dimension can either equal corresponding data dimension or equal 1 - to indicate that dimension is shared.</li>
<li>Prelu primitive requires that \(\diffweights\) tensor has exact same dimensions sizes as \(\weights\) tensor, \(\diffsrc\) as src and \(\diffdst\) as dst.</li>
<li>\(\weights\) tensor can be initialized with format_tag::any primitive will match it to data tensor format.</li>
</ul>
<h3>Data Type Support</h3>
<p>The PReLU primitive supports the following combinations of data types:</p>
<table class="doxtable">
<tr>
<th align="left">Propagation </th><th align="left">Source / Destination  </th></tr>
<tr>
<td align="left">forward / backward </td><td align="left">f32, s32, bf16, s8, u8 </td></tr>
</table>
<h3>Data Representation</h3>
<p>The PReLU primitive works with arbitrary data tensors. There is no special meaning associated with any logical dimensions.</p>
<h2>Implementation Limitations</h2>
<p>Current implementation supports all tensors up to 3D spatial (n, c, d, h, w).</p>
<h2>Performance Tips</h2>
<p>Its recommended to allow PReLU primitive to choose the appropriate weights memory format by passing weights_md with format_tag::any. For best performance, the weights memory format should match data memory format.</p>
<h2>Examples</h2>
<table class="doxtable">
<tr>
<th align="left">Engine </th><th align="left">Name </th><th align="left">Comments  </th></tr>
<tr>
<td align="left">CPU/GPU </td><td align="left"><a class="el" href="prelu_example_cpp.html">Primitive Example</a> </td><td align="left">This C++ API example demonstrates how to create and execute an <a class="el" href="dev_guide_prelu.html">PReLU</a> primitive in forward training propagation mode. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>