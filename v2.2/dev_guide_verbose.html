<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>oneDNN: Verbose Mode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div class="mobile-nav"><i id="nav-btn"></i><a href="index.html">oneAPI Deep Neural Network Library (oneDNN)</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">
     <a href="index.html">
      <div id="full-name">oneAPI Deep Neural Network Library (oneDNN)</div>
    </a>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
   <div id="projectnumber">2.2.4</div>
  <div>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dev_guide_verbose.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Verbose Mode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is often useful to collect information about how much of an application runtime is spent executing oneDNN primitives and which of those take the most time. oneDNN verbose mode enables tracing execution of oneDNN primitives and collection of basic statistics like execution time and primitive parameters. When verbose mode is enabled oneDNN will print out information to <code>stdout</code>.</p>
<h2>Build-time Controls</h2>
<p>At build-time, support for this feature is controlled via cmake option <code>DNNL_VERBOSE</code>.</p>
<table class="doxtable">
<tr>
<th align="left">CMake Option </th><th align="left">Supported values (defaults in bold) </th><th align="left">Description  </th></tr>
<tr>
<td align="left">DNNL_VERBOSE </td><td align="left"><b>ON</b>, OFF </td><td align="left">Enables <a class="el" href="dev_guide_verbose.html">verbose mode</a> </td></tr>
</table>
<h2>Run-time Controls</h2>
<p>When the feature is enabled at build-time, the <code>DNNL_VERBOSE</code> environment variable can be used to turn verbose mode on and control the level of verbosity.</p>
<table class="doxtable">
<tr>
<th align="left">Environment variable </th><th align="left">Value </th><th align="left">Description  </th></tr>
<tr>
<td align="left">DNNL_VERBOSE </td><td align="left"><b>0</b> </td><td align="left"><b>no verbose output (default)</b> </td></tr>
<tr>
<td align="left"></td><td align="left">1 </td><td align="left">primitive information at execution </td></tr>
<tr>
<td align="left"></td><td align="left">2 </td><td align="left">primitive information at creation and execution </td></tr>
<tr>
<td align="left">DNNL_VERBOSE_TIMESTAMP </td><td align="left"><b>0</b> </td><td align="left"><b>display timestamps disabled (default)</b> </td></tr>
<tr>
<td align="left"></td><td align="left">1 </td><td align="left">display timestamps enabled </td></tr>
</table>
<p>This feature can also be managed at run-time with the following functions:</p>
<ul>
<li><a class="el" href="group__dnnl__api__service.html#ga14cc3b56337322e1e5132c5ee0c84856">dnnl_set_verbose</a></li>
</ul>
<p>The function setting takes precedence over the environment variable.</p>
<h2>Example</h2>
<h3>Enable DNNL_VERBOSE</h3>
<div class="fragment"><div class="line">DNNL_VERBOSE=1 ./benchdnn --conv ic16ih7oc16oh7kh5ph2n<span class="stringliteral">&quot;wip&quot;</span></div>
</div><!-- fragment --><p>This produces the following output (the line breaks were added to fit the page width):</p>
<div class="fragment"><div class="line">dnnl_verbose,info,DNNL v1.3.0 (commit d0fc158e98590dfad0165e568ca466876a794597)</div>
<div class="line">dnnl_verbose,info,cpu,runtime:OpenMP</div>
<div class="line">dnnl_verbose,info,cpu,isa:Intel AVX2</div>
<div class="line">dnnl_verbose,info,gpu,runtime:none</div>
<div class="line">dnnl_verbose,info,prim_template:operation,engine,primitive,implementation,<a class="code" href="group__dnnl__api__attributes.html#gac7db48f6583aa9903e54c2a39d65438f">prop_kind</a>,memory_descriptors,attributes,auxiliary,problem_desc,exec_time</div>
<div class="line">dnnl_verbose,exec,cpu,reorder,jit:uni,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:aBcd8b:f0,,,2x16x7x7,0.0200195</div>
<div class="line">dnnl_verbose,exec,cpu,reorder,jit:uni,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:ABcd8b8a:f0,,,16x16x5x5,0.0251465</div>
<div class="line">dnnl_verbose,exec,cpu,reorder,jit:uni,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:aBcd8b:f0,,,2x16x7x7,0.0180664</div>
<div class="line">dnnl_verbose,exec,cpu,reorder,simple:any,undef,src_f32::blocked:a:f0 dst_f32::blocked:a:f0,,,16,0.0229492</div>
<div class="line">dnnl_verbose,exec,cpu,convolution,jit:avx2,forward_training,src_f32::blocked:aBcd8b:f0 wei_f32::blocked:ABcd8b8a:f0 bia_f32::blocked:a:f0 dst_f32::blocked:aBcd8b:f0,,alg:convolution_direct,mb2_ic16oc16_ih7oh7kh5sh1dh0ph2_iw7ow7kw5sw1dw0pw2,0.0390625</div>
<div class="line">dnnl_verbose,exec,cpu,reorder,jit:uni,undef,src_f32::blocked:aBcd8b:f0 dst_f32::blocked:abcd:f0,,,2x16x7x7,0.173096</div>
</div><!-- fragment --><h3>Enable DNNL_VERBOSE with timestamps</h3>
<div class="fragment"><div class="line">DNNL_VERBOSE=1 DNNL_VERBOSE_TIMESTAMP=1 ./benchdnn --conv ic16ih7oc16oh7kh5ph2n<span class="stringliteral">&quot;wip&quot;</span></div>
</div><!-- fragment --><p>This produces the following output (the line breaks were added to fit the page width):</p>
<div class="fragment"><div class="line">dnnl_verbose,info,oneDNN v2.0.0 (commit N/A)</div>
<div class="line">dnnl_verbose,info,cpu,runtime:OpenMP</div>
<div class="line">dnnl_verbose,info,cpu,isa:Intel AVX2</div>
<div class="line">dnnl_verbose,info,gpu,runtime:none</div>
<div class="line">dnnl_verbose,info,prim_template:timestamp,operation,engine,primitive,implementation,<a class="code" href="group__dnnl__api__attributes.html#gac7db48f6583aa9903e54c2a39d65438f">prop_kind</a>,memory_descriptors,attributes,auxiliary,problem_desc,exec_time</div>
<div class="line">dnnl_verbose,1607393146348.667969,exec,cpu,reorder,jit:blk,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:aBcd8b:f0,,,2x16x7x7,3.58594</div>
<div class="line">dnnl_verbose,1607393146356.743896,exec,cpu,reorder,jit:uni,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:ABcd8b8a:f0,,,16x16x5x5,3.63916</div>
<div class="line">dnnl_verbose,1607393146364.541992,exec,cpu,reorder,jit:blk,undef,src_f32::blocked:abcd:f0 dst_f32::blocked:aBcd8b:f0,,,2x16x7x7,2.35693</div>
<div class="line">dnnl_verbose,1607393146367.198975,exec,cpu,reorder,simple:any,undef,src_f32::blocked:a:f0 dst_f32::blocked:a:f0,,,16,3.71191</div>
<div class="line">dnnl_verbose,1607393146371.002930,exec,cpu,convolution,jit:avx2,forward_training,src_f32::blocked:aBcd8b:f0 wei_f32::blocked:ABcd8b8a:f0 bia_f32::blocked:a:f0 dst_f32::blocked:aBcd8b:f0,,alg:convolution_direct,mb2_ic16oc16_ih7oh7kh5sh1dh0ph2_iw7ow7kw5sw1dw0pw2,3.93018</div>
<div class="line">dnnl_verbose,1607393146380.145020,exec,cpu,reorder,jit:blk,undef,src_f32::blocked:aBcd8b:f0 dst_f32::blocked:abcd:f0,,,2x16x7x7,1.75708</div>
</div><!-- fragment --><h2>Decrypting the Output</h2>
<p>The first lines of verbose information, which are denoted with <code>info</code>, contain the build version and git hash, if available, as well as CPU and GPU runtimes, the supported instruction set architecture and the verbose output format template since amount of fields may vary depeding on set of enviroment variables enabled.</p>
<p>Each subsequent line of verbose information is formatted as a comma-separated list contains, in order of appearance in the line from left to right:</p>
<ul>
<li><code>dnnl_verbose</code> marker string</li>
<li>if <code>DNNL_VERBOSE_TIMESTAMP=1</code> is specified, start time of the call. On Linux this number represents amount of milliseconds since Unix epoch. On Windows this number represents amount of milliseconds since the last system start.</li>
<li>operation: <code>create:&lt;cache_hit|cache_miss&gt;</code> or <code>exec</code></li>
<li>engine kind: <code>cpu</code> or <code>gpu</code> (<code>cpu2gpu</code> or <code>gpu2cpu</code> for cross-engine reorder)</li>
<li>primitive name: <code>convolution</code>, <code>reorder</code>, <code>sum</code>, etc</li>
<li>primitive implementation</li>
<li>propagation kind: <code>forward_training</code>, <code>forward_inference</code>, <code>backward</code>, etc</li>
<li>information about all operation tensors (separated by space)</li>
<li>primitive attributes</li>
<li>auxiliary information like algorithm name or number of inputs</li>
<li>a problem description in <a class="el" href="dev_guide_benchdnn.html">benchdnn format</a></li>
<li>execution time in milliseconds</li>
</ul>
<p>The information about a particular operation tensors has the following format: <code>tensor_name</code>_<code>data_type</code>::<code>format_kind</code>:<code>format_tag</code>:<code>extra_flags</code>, where:</p>
<ol type="1">
<li><code>tensor_name</code> is one of the tensors names listed in the <a class="el" href="dev_guide_conventions.html">Naming Conventions</a>, and denotes a tensor supported by the corresponding primitive, and</li>
<li><code>data_type</code>, <code>format_kind</code>, <code>format_tag</code>, and <code>extra_flags</code> denote values from <a class="el" href="structdnnl_1_1memory.html#a8e83474ec3a50e08e37af76c8c075dce" title="Data type specification. ">dnnl::memory::data_type</a>, <a class="el" href="structdnnl_1_1memory.html#aabcadfb0e23a36a91272fc571cff105f" title="Memory format kind. ">dnnl::memory::format_kind</a>, <a class="el" href="structdnnl_1_1memory.html#a8e71077ed6a5f7fb7b3e6e1a5a2ecf3f" title="Memory format tag specification. ">dnnl::memory::format_tag</a>, and <a class="el" href="group__dnnl__api__memory.html#ga29a3828f894856ee61f6a11cd4a39dca" title="Flags for memory special features. ">dnnl_memory_extra_flags_t</a> respectively. Note, that certain markers may be missing in some cases, such as <code>format_tag</code> for the \(\weights\) tensor for the int8 Winograd convolution.</li>
</ol>
<p>Please see the profiling example <a class="el" href="performance_profiling_cpp.html">here</a>, as it uses DNNL_VERBOSE output to tune oneDNN code to align with <a class="el" href="dev_guide_inference.html">best practices</a>.</p>
<dl class="section note"><dt>Note</dt><dd>When oneDNN verbose mode is enabled with GPU engines, oneDNN adds extra stream synchronization on entry and on exit in the <a class="el" href="structdnnl_1_1primitive.html#a18a484f0f1fecbc6a58fca1a58f6d8d4" title="Executes computations specified by the primitive in a specified stream. ">dnnl::primitive::execute()</a> call. The execution time is calculated based on wall time measured before and after primitive execution.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Verbose mode has non-negligible performance impact especially on GPU or if the output rate is high. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div class="footer">
    <script>
        $('#top').prependTo($('#side-nav'));
    </script>
    <div class="footer-wrapper">
        <hr>
        <ul class="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>