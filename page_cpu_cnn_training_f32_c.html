
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>CNN f32 training example &#8212; oneDNN v2.5.0 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/target-highlight.js"></script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">oneDNN v2.5.0 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="build_and_link.html">
   Building and Linking
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_build.html">
     Build from Source
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_build_options.html">
     Build Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_link.html">
     Linking to the Library
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="programming_model.html">
   Programming Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_basic_concepts.html">
     Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_getting_started_cpp.html">
     Getting started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_memory_format_propagation_cpp.html">
     Memory Format Propagation
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="dev_guide_inference_and_training_aspects.html">
     Inference and Training Aspects
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_inference.html">
       Inference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_inference_int8.html">
       Int8 Inference
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_training_bf16.html">
       Bfloat16 Training
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="dev_guide_attributes.html">
     Primitive Attributes
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_fpmath_mode.html">
       Primitive Attributes: floating-point math mode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_quantization.html">
       Primitive Attributes: Quantization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_post_ops.html">
       Primitive Attributes: Post-ops
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_attributes_scratchpad.html">
       Primitive Attributes: Scratchpad
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_data_types.html">
     Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_cross_engine_reorder_cpp.html">
     Reorder between CPU and GPU engines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_c_and_cpp_apis.html">
     API
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="interop_with_dpcpp_and_opencl.html">
     Interoperability with DPC++ and OpenCL
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_opencl_interoperability.html">
       OpenCL Interoperability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_dpcpp_interoperability.html">
       DPC++ Interoperability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="dev_guide_dpcpp_backends.html">
       DPC++ Backends Support: OpenCL and Level Zero
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="supported_primitives.html">
   Supported Primitives
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_convolution.html">
     Convolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_inner_product.html">
     Inner Product
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_matmul.html">
     Matrix Multiplication
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_rnn.html">
     RNN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_batch_normalization.html">
     Batch Normalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_binary.html">
     Binary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_concat.html">
     Concat
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_eltwise.html">
     Eltwise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_layer_normalization.html">
     Layer Normalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_lrn.html">
     Local Response Normalization (LRN)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_logsoftmax.html">
     LogSoftmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_pooling.html">
     Pooling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_prelu.html">
     PReLU
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_resampling.html">
     Resampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_shuffle.html">
     Shuffle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_softmax.html">
     Softmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_sum.html">
     Sum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_reorder.html">
     Reorder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_reduction.html">
     Reduction
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dev_guide_examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="performance_profiling_and_inspection.html">
   Performance Profiling and Inspection
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_verbose.html">
     Verbose Mode
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_performance_settings.html">
     Configuring oneDNN for Benchmarking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_benchdnn.html">
     Benchmarking Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_profilers.html">
     Profiling oneDNN Performance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_inspecting_jit.html">
     Inspecting JIT Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_performance_profiling_cpp.html">
     Performance Profiling Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_cpu_dispatcher_control.html">
     CPU Dispatcher Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_cpu_isa_hints.html">
     CPU ISA Hints
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="advanced_topics.html">
   Advanced Topics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_transition_to_dnnl.html">
     Transitioning from Intel MKL-DNN to oneDNN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_understanding_memory_formats.html">
     Understanding Memory Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_int8_computations.html">
     Nuances of int8 Computations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_primitive_cache.html">
     Primitive Cache
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_persistent_cache.html">
     Persistent Cache
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dev_guide_threadpool.html">
     Using oneDNN with Threadpool-Based Threading
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="group_dnnl_api.html">
   oneDNN API
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_primitives.html">
     Primitives
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_primitives_common.html">
       Common
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_alg_kind_t.html">
         enum dnnl_alg_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_normalization_flags_t.html">
         enum dnnl_normalization_flags_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_primitive_kind_t.html">
         enum dnnl_primitive_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_prop_kind_t.html">
         enum dnnl_prop_kind_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_query_t.html">
         enum dnnl_query_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_normalization_flags.html">
         enum dnnl::normalization_flags
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_query.html">
         enum dnnl::query
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_exec_arg_t.html">
         struct dnnl_exec_arg_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive.html">
         struct dnnl_primitive
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc.html">
         struct dnnl_primitive_desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc_iterator.html">
         struct dnnl_primitive_desc_iterator
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive-2.html">
         struct dnnl::primitive
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_primitive_kind.html">
           enum dnnl::primitive::kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc-2.html">
         struct dnnl::primitive_desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_desc_base.html">
         struct dnnl::primitive_desc_base
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_attributes.html">
       Attributes
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_algorithm.html">
         enum dnnl::algorithm
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_fpmath_mode_t.html">
         enum dnnl_fpmath_mode_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_scratchpad_mode_t.html">
         enum dnnl_scratchpad_mode_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_fpmath_mode.html">
         enum dnnl::fpmath_mode
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_prop_kind.html">
         enum dnnl::prop_kind
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_scratchpad_mode.html">
         enum dnnl::scratchpad_mode
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_post_ops.html">
         struct dnnl_post_ops
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_primitive_attr.html">
         struct dnnl_primitive_attr
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_post_ops-2.html">
         struct dnnl::post_ops
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_reorder.html">
       Reorder
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_reorder.html">
         struct dnnl::reorder
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_reorder_primitive_desc.html">
           struct dnnl::reorder::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_concat.html">
       Concat
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_concat.html">
         struct dnnl::concat
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_concat_primitive_desc.html">
           struct dnnl::concat::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_sum.html">
       Sum
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_sum.html">
         struct dnnl::sum
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_sum_primitive_desc.html">
           struct dnnl::sum::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_binary.html">
       Binary
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_binary.html">
         struct dnnl::binary
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_binary_desc.html">
           struct dnnl::binary::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_binary_primitive_desc.html">
           struct dnnl::binary::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_binary_desc_t.html">
         struct dnnl_binary_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_convolution.html">
       Convolution
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_backward_data.html">
         struct dnnl::convolution_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_data_desc.html">
           struct dnnl::convolution_backward_data::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_data_primitive_desc.html">
           struct dnnl::convolution_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_backward_weights.html">
         struct dnnl::convolution_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_weights_desc.html">
           struct dnnl::convolution_backward_weights::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_backward_weights_primitive_desc.html">
           struct dnnl::convolution_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_forward.html">
         struct dnnl::convolution_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_forward_desc.html">
           struct dnnl::convolution_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_convolution_forward_primitive_desc.html">
           struct dnnl::convolution_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_convolution_desc_t.html">
         struct dnnl_convolution_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_deconvolution.html">
       Deconvolution
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_backward_data.html">
         struct dnnl::deconvolution_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_data_desc.html">
           struct dnnl::deconvolution_backward_data::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_data_primitive_desc.html">
           struct dnnl::deconvolution_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_backward_weights.html">
         struct dnnl::deconvolution_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_weights_desc.html">
           struct dnnl::deconvolution_backward_weights::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_backward_weights_primitive_desc.html">
           struct dnnl::deconvolution_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_deconvolution_forward.html">
         struct dnnl::deconvolution_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_forward_desc.html">
           struct dnnl::deconvolution_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_deconvolution_forward_primitive_desc.html">
           struct dnnl::deconvolution_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_shuffle.html">
       Shuffle
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_shuffle_desc_t.html">
         struct dnnl_shuffle_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_shuffle_backward.html">
         struct dnnl::shuffle_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_backward_desc.html">
           struct dnnl::shuffle_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_backward_primitive_desc.html">
           struct dnnl::shuffle_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_shuffle_forward.html">
         struct dnnl::shuffle_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_forward_desc.html">
           struct dnnl::shuffle_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_shuffle_forward_primitive_desc.html">
           struct dnnl::shuffle_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_eltwise.html">
       Eltwise
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_eltwise_desc_t.html">
         struct dnnl_eltwise_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_eltwise_backward.html">
         struct dnnl::eltwise_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_backward_desc.html">
           struct dnnl::eltwise_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_backward_primitive_desc.html">
           struct dnnl::eltwise_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_eltwise_forward.html">
         struct dnnl::eltwise_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_forward_desc.html">
           struct dnnl::eltwise_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_eltwise_forward_primitive_desc.html">
           struct dnnl::eltwise_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_softmax.html">
       Softmax
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_desc_t.html">
         struct dnnl_softmax_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_backward.html">
         struct dnnl::softmax_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_backward_desc.html">
           struct dnnl::softmax_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_backward_primitive_desc.html">
           struct dnnl::softmax_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_forward.html">
         struct dnnl::softmax_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_forward_desc.html">
           struct dnnl::softmax_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_forward_primitive_desc.html">
           struct dnnl::softmax_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_softmax_v2.html">
       Softmax_v2
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_v2_desc_t.html">
         struct dnnl_softmax_v2_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_v2_backward.html">
         struct dnnl::softmax_v2_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_v2_backward_desc.html">
           struct dnnl::softmax_v2_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_v2_backward_primitive_desc.html">
           struct dnnl::softmax_v2_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_softmax_v2_forward.html">
         struct dnnl::softmax_v2_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_v2_forward_desc.html">
           struct dnnl::softmax_v2_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_softmax_v2_forward_primitive_desc.html">
           struct dnnl::softmax_v2_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_logsoftmax.html">
       LogSoftmax
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_logsoftmax_backward.html">
         struct dnnl::logsoftmax_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_logsoftmax_backward_desc.html">
           struct dnnl::logsoftmax_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_logsoftmax_backward_primitive_desc.html">
           struct dnnl::logsoftmax_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_logsoftmax_forward.html">
         struct dnnl::logsoftmax_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_logsoftmax_forward_desc.html">
           struct dnnl::logsoftmax_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_logsoftmax_forward_primitive_desc.html">
           struct dnnl::logsoftmax_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_pooling.html">
       Pooling
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_desc_t.html">
         struct dnnl_pooling_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_backward.html">
         struct dnnl::pooling_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_backward_desc.html">
           struct dnnl::pooling_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_backward_primitive_desc.html">
           struct dnnl::pooling_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_forward.html">
         struct dnnl::pooling_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_forward_desc.html">
           struct dnnl::pooling_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_forward_primitive_desc.html">
           struct dnnl::pooling_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_pooling_v2.html">
       Pooling_v2
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_v2_desc_t.html">
         struct dnnl_pooling_v2_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_v2_backward.html">
         struct dnnl::pooling_v2_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_v2_backward_desc.html">
           struct dnnl::pooling_v2_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_v2_backward_primitive_desc.html">
           struct dnnl::pooling_v2_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_pooling_v2_forward.html">
         struct dnnl::pooling_v2_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_v2_forward_desc.html">
           struct dnnl::pooling_v2_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_pooling_v2_forward_primitive_desc.html">
           struct dnnl::pooling_v2_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_prelu.html">
       PReLU
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_prelu_desc_t.html">
         struct dnnl_prelu_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_prelu_backward.html">
         struct dnnl::prelu_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_backward_desc.html">
           struct dnnl::prelu_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_backward_primitive_desc.html">
           struct dnnl::prelu_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_prelu_forward.html">
         struct dnnl::prelu_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_forward_desc.html">
           struct dnnl::prelu_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_prelu_forward_primitive_desc.html">
           struct dnnl::prelu_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_lrn.html">
       LRN
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lrn_desc_t.html">
         struct dnnl_lrn_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lrn_backward.html">
         struct dnnl::lrn_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_backward_desc.html">
           struct dnnl::lrn_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_backward_primitive_desc.html">
           struct dnnl::lrn_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lrn_forward.html">
         struct dnnl::lrn_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_forward_desc.html">
           struct dnnl::lrn_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lrn_forward_primitive_desc.html">
           struct dnnl::lrn_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_batch_normalization.html">
       Batch Normalization
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_batch_normalization_backward.html">
         struct dnnl::batch_normalization_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_backward_desc.html">
           struct dnnl::batch_normalization_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_backward_primitive_desc.html">
           struct dnnl::batch_normalization_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_batch_normalization_forward.html">
         struct dnnl::batch_normalization_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_forward_desc.html">
           struct dnnl::batch_normalization_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_batch_normalization_forward_primitive_desc.html">
           struct dnnl::batch_normalization_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_batch_normalization_desc_t.html">
         struct dnnl_batch_normalization_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_layer_normalization.html">
       Layer Normalization
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_layer_normalization_desc_t.html">
         struct dnnl_layer_normalization_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_layer_normalization_backward.html">
         struct dnnl::layer_normalization_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_backward_desc.html">
           struct dnnl::layer_normalization_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_backward_primitive_desc.html">
           struct dnnl::layer_normalization_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_layer_normalization_forward.html">
         struct dnnl::layer_normalization_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_forward_desc.html">
           struct dnnl::layer_normalization_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_layer_normalization_forward_primitive_desc.html">
           struct dnnl::layer_normalization_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_inner_product.html">
       Inner Product
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_desc_t.html">
         struct dnnl_inner_product_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_backward_data.html">
         struct dnnl::inner_product_backward_data
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_data_desc.html">
           struct dnnl::inner_product_backward_data::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_data_primitive_desc.html">
           struct dnnl::inner_product_backward_data::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_backward_weights.html">
         struct dnnl::inner_product_backward_weights
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_weights_desc.html">
           struct dnnl::inner_product_backward_weights::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_backward_weights_primitive_desc.html">
           struct dnnl::inner_product_backward_weights::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_inner_product_forward.html">
         struct dnnl::inner_product_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_forward_desc.html">
           struct dnnl::inner_product_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_inner_product_forward_primitive_desc.html">
           struct dnnl::inner_product_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_rnn.html">
       RNN
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_direction_t.html">
         enum dnnl_rnn_direction_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_flags_t.html">
         enum dnnl_rnn_flags_t
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_direction.html">
         enum dnnl::rnn_direction
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_rnn_flags.html">
         enum dnnl::rnn_flags
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_augru_backward.html">
         struct dnnl::augru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_backward_desc.html">
           struct dnnl::augru_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_backward_primitive_desc.html">
           struct dnnl::augru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_augru_forward.html">
         struct dnnl::augru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_forward_desc.html">
           struct dnnl::augru_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_augru_forward_primitive_desc.html">
           struct dnnl::augru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_rnn_desc_t.html">
         struct dnnl_rnn_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_gru_backward.html">
         struct dnnl::gru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_backward_desc.html">
           struct dnnl::gru_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_backward_primitive_desc.html">
           struct dnnl::gru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_gru_forward.html">
         struct dnnl::gru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_forward_desc.html">
           struct dnnl::gru_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_gru_forward_primitive_desc.html">
           struct dnnl::gru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_augru_backward.html">
         struct dnnl::lbr_augru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_backward_desc.html">
           struct dnnl::lbr_augru_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_backward_primitive_desc.html">
           struct dnnl::lbr_augru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_augru_forward.html">
         struct dnnl::lbr_augru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_forward_desc.html">
           struct dnnl::lbr_augru_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_augru_forward_primitive_desc.html">
           struct dnnl::lbr_augru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_gru_backward.html">
         struct dnnl::lbr_gru_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_backward_desc.html">
           struct dnnl::lbr_gru_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_backward_primitive_desc.html">
           struct dnnl::lbr_gru_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lbr_gru_forward.html">
         struct dnnl::lbr_gru_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_forward_desc.html">
           struct dnnl::lbr_gru_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lbr_gru_forward_primitive_desc.html">
           struct dnnl::lbr_gru_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lstm_backward.html">
         struct dnnl::lstm_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_backward_desc.html">
           struct dnnl::lstm_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_backward_primitive_desc.html">
           struct dnnl::lstm_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_lstm_forward.html">
         struct dnnl::lstm_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_forward_desc.html">
           struct dnnl::lstm_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_lstm_forward_primitive_desc.html">
           struct dnnl::lstm_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_rnn_primitive_desc_base.html">
         struct dnnl::rnn_primitive_desc_base
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_vanilla_rnn_backward.html">
         struct dnnl::vanilla_rnn_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_backward_desc.html">
           struct dnnl::vanilla_rnn_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_backward_primitive_desc.html">
           struct dnnl::vanilla_rnn_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_vanilla_rnn_forward.html">
         struct dnnl::vanilla_rnn_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_forward_desc.html">
           struct dnnl::vanilla_rnn_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_vanilla_rnn_forward_primitive_desc.html">
           struct dnnl::vanilla_rnn_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_matmul.html">
       Matrix Multiplication
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_matmul_desc_t.html">
         struct dnnl_matmul_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_matmul.html">
         struct dnnl::matmul
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_matmul_desc.html">
           struct dnnl::matmul::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_matmul_primitive_desc.html">
           struct dnnl::matmul::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_resampling.html">
       Resampling
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_resampling_desc_t.html">
         struct dnnl_resampling_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_resampling_backward.html">
         struct dnnl::resampling_backward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_backward_desc.html">
           struct dnnl::resampling_backward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_backward_primitive_desc.html">
           struct dnnl::resampling_backward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_resampling_forward.html">
         struct dnnl::resampling_forward
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_forward_desc.html">
           struct dnnl::resampling_forward::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_resampling_forward_primitive_desc.html">
           struct dnnl::resampling_forward::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_reduction.html">
       Reduction
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_reduction_desc_t.html">
         struct dnnl_reduction_desc_t
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_reduction.html">
         struct dnnl::reduction
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_reduction_desc.html">
           struct dnnl::reduction::desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_reduction_primitive_desc.html">
           struct dnnl::reduction::primitive_desc
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_memory.html">
     Memory
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_data_type_t.html">
       enum dnnl_data_type_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_format_kind_t.html">
       enum dnnl_format_kind_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_format_tag_t.html">
       enum dnnl_format_tag_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_memory_extra_flags_t.html">
       enum dnnl_memory_extra_flags_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_rnn_packed_memory_format_t.html">
       enum dnnl_rnn_packed_memory_format_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_wino_memory_format_t.html">
       enum dnnl_wino_memory_format_t
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_blocking_desc_t.html">
       struct dnnl_blocking_desc_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory.html">
       struct dnnl_memory
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory_desc_t.html">
       struct dnnl_memory_desc_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory_extra_desc_t.html">
       struct dnnl_memory_extra_desc_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_rnn_packed_desc_t.html">
       struct dnnl_rnn_packed_desc_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_wino_desc_t.html">
       struct dnnl_wino_desc_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_memory-2.html">
       struct dnnl::memory
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_data_type.html">
         enum dnnl::memory::data_type
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_format_kind.html">
         enum dnnl::memory::format_kind
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_memory_format_tag.html">
         enum dnnl::memory::format_tag
        </a>
       </li>
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="struct_dnnl_memory_desc.html">
         struct dnnl::memory::desc
        </a>
        <ul class="simple collapse-ul">
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_engine.html">
     Engine
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_engine_kind_t.html">
       enum dnnl_engine_kind_t
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_engine.html">
       struct dnnl_engine
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_engine-2.html">
       struct dnnl::engine
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_engine_kind.html">
         enum dnnl::engine::kind
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_stream.html">
     Stream
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_stream_flags_t.html">
       enum dnnl_stream_flags_t
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_stream.html">
       struct dnnl_stream
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_stream-2.html">
       struct dnnl::stream
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_stream_flags.html">
         enum dnnl::stream::flags
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_primitive_cache.html">
     Primitive Cache
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_mathmode.html">
     Floating-point Math Mode
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_service.html">
     Service
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_cpu_isa.html">
       enum dnnl::cpu_isa
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_cpu_isa_hints.html">
       enum dnnl::cpu_isa_hints
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_cpu_isa_hints_t.html">
       enum dnnl_cpu_isa_hints_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_cpu_isa_t.html">
       enum dnnl_cpu_isa_t
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_status.html">
       enum dnnl::status
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_version_t.html">
       struct dnnl_version_t
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_blas.html">
     BLAS functions
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_interop.html">
     Runtime interoperability API
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_ocl_interop.html">
       OpenCL interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_ocl_interop.html">
         namespace dnnl::ocl_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_ocl_interop_memory_kind.html">
           enum dnnl::ocl_interop::memory_kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_ocl_interop_memory_kind_t.html">
         enum dnnl_ocl_interop_memory_kind_t
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_sycl_interop.html">
       SYCL interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_sycl_interop.html">
         namespace dnnl::sycl_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5">
          <a class="reference internal" href="enum_dnnl_sycl_interop_memory_kind.html">
           enum dnnl::sycl_interop::memory_kind
          </a>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="enum_dnnl_sycl_interop_memory_kind_t.html">
         enum dnnl_sycl_interop_memory_kind_t
        </a>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="group_dnnl_api_threadpool_interop.html">
       Threadpool interoperability API
      </a>
      <ul class="collapse-ul">
       <li class="toctree-l4 collapsible-parent">
        <a class="reference internal" href="namespace_dnnl_threadpool_interop.html">
         namespace dnnl::threadpool_interop
        </a>
        <ul class="collapse-ul">
         <li class="toctree-l5 collapsible-parent">
          <a class="reference internal" href="struct_dnnl_threadpool_interop_threadpool_iface.html">
           struct dnnl::threadpool_interop::threadpool_iface
          </a>
          <ul class="simple collapse-ul">
          </ul>
          <i class="fas fa-chevron-down">
          </i>
         </li>
        </ul>
        <i class="fas fa-chevron-down">
        </i>
       </li>
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="group_dnnl_api_utils.html">
     Utilities
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="enum_dnnl_status_t.html">
       enum dnnl_status_t
      </a>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_error.html">
       struct dnnl::error
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_handle.html">
       template struct dnnl::handle
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
     <li class="toctree-l3 collapsible-parent">
      <a class="reference internal" href="struct_dnnl_handle_traits.html">
       template struct dnnl::handle_traits
      </a>
      <ul class="simple collapse-ul">
      </ul>
      <i class="fas fa-chevron-down">
      </i>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="namespace_dnnl.html">
     namespace dnnl
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="namespace_oneapi.html">
     namespace oneapi
    </a>
    <ul class="simple collapse-ul">
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/page_cpu_cnn_training_f32_c.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="cnn-f32-training-example">
<span id="doxid-cpu-cnn-training-f32-c"></span><span id="index-0"></span><h1>CNN f32 training example<a class="headerlink" href="#cnn-f32-training-example" title="Permalink to this headline"></a></h1>
<p>This C API example demonstrates how to build an AlexNet model training.</p>
<p>The example implements a few layers from AlexNet model.</p>
<pre class="highlight literal-block"><span></span><span class="cm">/*******************************************************************************</span>
<span class="cm">* Copyright 2016-2021 Intel Corporation</span>
<span class="cm">*</span>
<span class="cm">* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm">* you may not use this file except in compliance with the License.</span>
<span class="cm">* You may obtain a copy of the License at</span>
<span class="cm">*</span>
<span class="cm">*     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm">*</span>
<span class="cm">* Unless required by applicable law or agreed to in writing, software</span>
<span class="cm">* distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm">* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm">* See the License for the specific language governing permissions and</span>
<span class="cm">* limitations under the License.</span>
<span class="cm">*******************************************************************************/</span>



<span class="c1">// Required for posix_memalign</span>
<span class="cp">#define _POSIX_C_SOURCE 200112L</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;oneapi/dnnl/dnnl.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;example_utils.h&quot;</span><span class="cp"></span>

<span class="cp">#define BATCH 8</span>
<span class="cp">#define IC 3</span>
<span class="cp">#define OC 96</span>
<span class="cp">#define CONV_IH 227</span>
<span class="cp">#define CONV_IW 227</span>
<span class="cp">#define CONV_OH 55</span>
<span class="cp">#define CONV_OW 55</span>
<span class="cp">#define CONV_STRIDE 4</span>
<span class="cp">#define CONV_PAD 0</span>
<span class="cp">#define POOL_OH 27</span>
<span class="cp">#define POOL_OW 27</span>
<span class="cp">#define POOL_STRIDE 2</span>
<span class="cp">#define POOL_PAD 0</span>

<span class="k">static</span> <span class="kt">size_t</span> <span class="n">product</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="o">*</span><span class="n">arr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">prod</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">init_net_data</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">dim</span><span class="p">,</span> <span class="k">const</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="o">*</span><span class="n">dims</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">1637</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">in</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">in</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">in</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">ic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ic</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="o">++</span><span class="n">ic</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">ih</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ih</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="o">++</span><span class="n">ih</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">iw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iw</span> <span class="o">&lt;</span> <span class="n">dims</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="o">++</span><span class="n">iw</span><span class="p">)</span> <span class="p">{</span>
                        <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="n">indx</span> <span class="o">=</span> <span class="n">in</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                                <span class="o">+</span> <span class="n">ic</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ih</span> <span class="o">*</span> <span class="n">dims</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">iw</span><span class="p">;</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">indx</span> <span class="o">%</span> <span class="mi">1637</span><span class="p">);</span>
                    <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">nargs</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t"><span class="std std-ref">dnnl_exec_arg_t</span></a><span></span> <span class="o">*</span><span class="n">args</span><span class="p">;</span>
<span class="p">}</span> <span class="n">args_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">prepare_arg_node</span><span class="p">(</span><span class="n">args_t</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nargs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t"><span class="std std-ref">dnnl_exec_arg_t</span></a><span></span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t"><span class="std std-ref">dnnl_exec_arg_t</span></a><span></span><span class="p">)</span> <span class="o">*</span> <span class="n">nargs</span><span class="p">);</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">free_arg_node</span><span class="p">(</span><span class="n">args_t</span> <span class="o">*</span><span class="n">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">free</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">set_arg</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t"><span class="std std-ref">dnnl_exec_arg_t</span></a><span></span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg_idx</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">memory</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">arg</span><span class="o">-&gt;</span><a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t-1a46c7f77870713b8af3fd37dc66e9690b"><span class="std std-ref">arg</span></a><span></span> <span class="o">=</span> <span class="n">arg_idx</span><span class="p">;</span>
    <span class="n">arg</span><span class="o">-&gt;</span><a class="reference internal" href="struct_dnnl_exec_arg_t.html#doxid-structdnnl-exec-arg-t-1a048f23e80b923636267c4dece912cd0d"><span class="std std-ref">memory</span></a><span></span> <span class="o">=</span> <span class="n">memory</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">init_data_memory</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">dim</span><span class="p">,</span> <span class="k">const</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga872631b12a112bf43fba985cba24dd20"><span class="std std-ref">dnnl_dim_t</span></a><span></span> <span class="o">*</span><span class="n">dims</span><span class="p">,</span>
        <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1ga395e42b594683adb25ed2d842bb3091d"><span class="std std-ref">dnnl_format_tag_t</span></a><span></span> <span class="n">user_tag</span><span class="p">,</span> <a class="reference internal" href="struct_dnnl_engine.html#doxid-structdnnl-engine"><span class="std std-ref">dnnl_engine_t</span></a><span></span> <span class="n">engine</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
        <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="o">*</span><span class="n">memory</span><span class="p">)</span> <span class="p">{</span>
    <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="n">user_md</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">user_md</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <span class="n">user_tag</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">user_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>
    <span class="n">write_to_dnnl_memory</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">memory</span><span class="p">);</span>
<span class="p">}</span>

<a class="reference internal" href="enum_dnnl_status_t.html#doxid-group-dnnl-api-utils-1gad24f9ded06e34d3ee71e7fc4b408d57a"><span class="std std-ref">dnnl_status_t</span></a><span></span> <span class="n">prepare_reorder</span><span class="p">(</span><a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="o">*</span><span class="n">user_memory</span><span class="p">,</span> <span class="c1">// in</span>
        <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">prim_memory_md</span><span class="p">,</span> <span class="c1">// in</span>
        <a class="reference internal" href="struct_dnnl_engine.html#doxid-structdnnl-engine"><span class="std std-ref">dnnl_engine_t</span></a><span></span> <span class="n">prim_engine</span><span class="p">,</span> <span class="c1">// in: primitive&#39;s engine</span>
        <span class="kt">int</span> <span class="n">dir_is_user_to_prim</span><span class="p">,</span> <span class="c1">// in: user -&gt; prim or prim -&gt; user</span>
        <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="o">*</span><span class="n">prim_memory</span><span class="p">,</span> <span class="c1">// out: primitive&#39;s memory created</span>
        <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="o">*</span><span class="n">reorder</span><span class="p">,</span> <span class="c1">// out: reorder primitive created</span>
        <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">net_index</span><span class="p">,</span> <span class="c1">// primitive index in net (inc if reorder created)</span>
        <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="o">*</span><span class="n">net</span><span class="p">,</span> <span class="n">args_t</span> <span class="o">*</span><span class="n">net_args</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// net params</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">user_memory_md</span><span class="p">;</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga59a447af4c51aba057856c7b596351d4"><span class="std std-ref">dnnl_memory_get_memory_desc</span></a><span></span><span class="p">(</span><span class="o">*</span><span class="n">user_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">user_memory_md</span><span class="p">);</span>

    <a class="reference internal" href="struct_dnnl_engine.html#doxid-structdnnl-engine"><span class="std std-ref">dnnl_engine_t</span></a><span></span> <span class="n">user_mem_engine</span><span class="p">;</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga583a4a06428de7d6c4251313e57ad814"><span class="std std-ref">dnnl_memory_get_engine</span></a><span></span><span class="p">(</span><span class="o">*</span><span class="n">user_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">user_mem_engine</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa734e01591b567ed6378df1f404058e2"><span class="std std-ref">dnnl_memory_desc_equal</span></a><span></span><span class="p">(</span><span class="n">user_memory_md</span><span class="p">,</span> <span class="n">prim_memory_md</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="n">prim_memory</span><span class="p">,</span> <span class="n">prim_memory_md</span><span class="p">,</span> <span class="n">prim_engine</span><span class="p">,</span>
                <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

        <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">reorder_pd</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dir_is_user_to_prim</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_reorder.html#doxid-group-dnnl-api-reorder-1ga099efa7b8fd12ae8de0e3e98fd0ae3ec"><span class="std std-ref">dnnl_reorder_primitive_desc_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">reorder_pd</span><span class="p">,</span>
                    <span class="n">user_memory_md</span><span class="p">,</span> <span class="n">user_mem_engine</span><span class="p">,</span> <span class="n">prim_memory_md</span><span class="p">,</span>
                    <span class="n">prim_engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_reorder.html#doxid-group-dnnl-api-reorder-1ga099efa7b8fd12ae8de0e3e98fd0ae3ec"><span class="std std-ref">dnnl_reorder_primitive_desc_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">reorder_pd</span><span class="p">,</span>
                    <span class="n">prim_memory_md</span><span class="p">,</span> <span class="n">prim_engine</span><span class="p">,</span> <span class="n">user_memory_md</span><span class="p">,</span>
                    <span class="n">user_mem_engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="n">reorder</span><span class="p">,</span> <span class="n">reorder_pd</span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">reorder_pd</span><span class="p">));</span>

        <span class="n">net</span><span class="p">[</span><span class="o">*</span><span class="n">net_index</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">reorder</span><span class="p">;</span>
        <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_args</span><span class="p">[</span><span class="o">*</span><span class="n">net_index</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_args</span><span class="p">[</span><span class="o">*</span><span class="n">net_index</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga953b34f004a8222b04e21851487c611a"><span class="std std-ref">DNNL_ARG_FROM</span></a><span></span><span class="p">,</span>
                <span class="n">dir_is_user_to_prim</span> <span class="o">?</span> <span class="o">*</span><span class="nl">user_memory</span> <span class="p">:</span> <span class="o">*</span><span class="n">prim_memory</span><span class="p">);</span>
        <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_args</span><span class="p">[</span><span class="o">*</span><span class="n">net_index</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaf700c3396987b450413c8df5d78bafd9"><span class="std std-ref">DNNL_ARG_TO</span></a><span></span><span class="p">,</span>
                <span class="n">dir_is_user_to_prim</span> <span class="o">?</span> <span class="o">*</span><span class="nl">prim_memory</span> <span class="p">:</span> <span class="o">*</span><span class="n">user_memory</span><span class="p">);</span>
        <span class="p">(</span><span class="o">*</span><span class="n">net_index</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">prim_memory</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="o">*</span><span class="n">reorder</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <a class="reference internal" href="enum_dnnl_status_t.html#doxid-group-dnnl-api-utils-1ggad24f9ded06e34d3ee71e7fc4b408d57aaa31395e9dccc103cf166cf7b38fc5b9c"><span class="std std-ref">dnnl_success</span></a><span></span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">simple_net</span><span class="p">()</span> <span class="p">{</span>
    <a class="reference internal" href="struct_dnnl_engine.html#doxid-structdnnl-engine"><span class="std std-ref">dnnl_engine_t</span></a><span></span> <span class="n">engine</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_engine.html#doxid-group-dnnl-api-engine-1gab84f82f3011349cbfe368b61882834fd"><span class="std std-ref">dnnl_engine_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_engine_kind_t.html#doxid-group-dnnl-api-engine-1gga04b3dd9eba628ea02218a52c4c4363a2abde7b942413dd36f8285dd360fc0c797"><span class="std std-ref">dnnl_cpu</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="c1">// idx</span>

    <span class="c1">// build a simple net</span>
    <span class="kt">uint32_t</span> <span class="n">n_fwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_bwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">net_fwd</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">net_bwd</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">args_t</span> <span class="n">net_fwd_args</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">net_bwd_args</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">ndims</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">net_src_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">BATCH</span><span class="p">,</span> <span class="n">IC</span><span class="p">,</span> <span class="n">CONV_IH</span><span class="p">,</span> <span class="n">CONV_IW</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">net_dst_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">BATCH</span><span class="p">,</span> <span class="n">OC</span><span class="p">,</span> <span class="n">POOL_OH</span><span class="p">,</span> <span class="n">POOL_OW</span><span class="p">};</span>

    <span class="kt">float</span> <span class="o">*</span><span class="n">net_src</span>
            <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">net_src_sizes</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">net_dst</span>
            <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">net_dst_sizes</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="n">init_net_data</span><span class="p">(</span><span class="n">net_src</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">net_src_sizes</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">net_dst</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">product</span><span class="p">(</span><span class="n">net_dst_sizes</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="c1">//----------------------------------------------------------------------</span>
    <span class="c1">//----------------- Forward Stream -------------------------------------</span>
    <span class="c1">// AlexNet: conv</span>
    <span class="c1">// {BATCH, IC, CONV_IH, CONV_IW} (x) {OC, IC, 11, 11} -&gt;</span>
    <span class="c1">// {BATCH, OC, CONV_OH, CONV_OW}</span>
    <span class="c1">// strides: {CONV_STRIDE, CONV_STRIDE}</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_user_src_sizes</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ndims</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">conv_user_src_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_src_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_user_weights_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">OC</span><span class="p">,</span> <span class="n">IC</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_bias_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">OC</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_user_dst_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">BATCH</span><span class="p">,</span> <span class="n">OC</span><span class="p">,</span> <span class="n">CONV_OH</span><span class="p">,</span> <span class="n">CONV_OW</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_strides</span> <span class="o">=</span> <span class="p">{</span><span class="n">CONV_STRIDE</span><span class="p">,</span> <span class="n">CONV_STRIDE</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">conv_padding</span> <span class="o">=</span> <span class="p">{</span><span class="n">CONV_PAD</span><span class="p">,</span> <span class="n">CONV_PAD</span><span class="p">};</span>

    <span class="kt">float</span> <span class="o">*</span><span class="n">conv_src</span> <span class="o">=</span> <span class="n">net_src</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">conv_weights</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span>
            <span class="n">product</span><span class="p">(</span><span class="n">conv_user_weights_sizes</span><span class="p">,</span> <span class="n">ndims</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">conv_bias</span>
            <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">conv_bias_sizes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="n">init_net_data</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">conv_user_weights_sizes</span><span class="p">);</span>
    <span class="n">init_net_data</span><span class="p">(</span><span class="n">conv_bias</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">conv_bias_sizes</span><span class="p">);</span>

    <span class="c1">// create memory for user data</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_user_src_memory</span><span class="p">,</span> <span class="n">conv_user_weights_memory</span><span class="p">,</span>
            <span class="n">conv_user_bias_memory</span><span class="p">;</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="n">ndims</span><span class="p">,</span> <span class="n">conv_user_src_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da83a751aedeb59613312339d0f8b90f54"><span class="std std-ref">dnnl_nchw</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">conv_src</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_user_src_memory</span><span class="p">);</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="n">ndims</span><span class="p">,</span> <span class="n">conv_user_weights_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da11176ff202375dcd0d06e2fba5f8a8e0"><span class="std std-ref">dnnl_oihw</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <span class="n">conv_weights</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_user_weights_memory</span><span class="p">);</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">conv_bias_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da9ccb37bb1a788f0245efbffbaf81e145"><span class="std std-ref">dnnl_x</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">conv_bias</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_user_bias_memory</span><span class="p">);</span>

    <span class="c1">// create a convolution</span>
    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">conv_pd</span><span class="p">;</span>

    <span class="p">{</span>
        <span class="c1">// create data descriptors for convolution w/ no specified format</span>
        <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="n">conv_src_md</span><span class="p">,</span> <span class="n">conv_weights_md</span><span class="p">,</span> <span class="n">conv_bias_md</span><span class="p">,</span>
                <span class="n">conv_dst_md</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_src_md</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span>
                <span class="n">conv_user_src_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_weights_md</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span>
                <span class="n">conv_user_weights_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">conv_bias_md</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">conv_bias_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da9ccb37bb1a788f0245efbffbaf81e145"><span class="std std-ref">dnnl_x</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_dst_md</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span>
                <span class="n">conv_user_dst_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>

        <a class="reference internal" href="struct_dnnl_convolution_desc_t.html#doxid-structdnnl-convolution-desc-t"><span class="std std-ref">dnnl_convolution_desc_t</span></a><span></span> <span class="n">conv_any_desc</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_convolution.html#doxid-group-dnnl-api-convolution-1ga9699a81a0e3341014447e4da0cdd7e18"><span class="std std-ref">dnnl_convolution_forward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_any_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_prop_kind_t.html#doxid-group-dnnl-api-primitives-common-1ggae3c1f22ae55645782923fbfd8b07d0c4a6a59d07a8414bb69b3cb9904ed302adb"><span class="std std-ref">dnnl_forward</span></a><span></span><span class="p">,</span>
                <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a8258635c519746dbf543ac13054acb5a"><span class="std std-ref">dnnl_convolution_direct</span></a><span></span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_src_md</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_weights_md</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">conv_bias_md</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_dst_md</span><span class="p">,</span> <span class="n">conv_strides</span><span class="p">,</span> <span class="n">conv_padding</span><span class="p">,</span>
                <span class="n">conv_padding</span><span class="p">));</span>

        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">conv_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_any_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>
    <span class="p">}</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_internal_src_memory</span><span class="p">,</span> <span class="n">conv_internal_weights_memory</span><span class="p">,</span>
            <span class="n">conv_internal_dst_memory</span><span class="p">;</span>

    <span class="c1">// create memory for dst data, we don&#39;t need to reorder it to user data</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_dst_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">conv_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059add5c338ad7ae0c296509e54d22130598"><span class="std std-ref">dnnl_query_dst_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_internal_dst_memory</span><span class="p">,</span> <span class="n">conv_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// create reorder primitives between user data and convolution srcs</span>
    <span class="c1">// if required</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv_reorder_src</span><span class="p">,</span> <span class="n">conv_reorder_weights</span><span class="p">;</span>

    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_src_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">conv_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a14a86faee7b85eeb60d0d7886756ffa5"><span class="std std-ref">dnnl_query_src_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_user_src_memory</span><span class="p">,</span> <span class="n">conv_src_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_internal_src_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_reorder_src</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_fwd</span><span class="p">,</span> <span class="n">net_fwd</span><span class="p">,</span>
            <span class="n">net_fwd_args</span><span class="p">));</span>

    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_weights_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">conv_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a12ea0b4858b84889acab34e498323355"><span class="std std-ref">dnnl_query_weights_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_user_weights_memory</span><span class="p">,</span> <span class="n">conv_weights_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_internal_weights_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_reorder_weights</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_fwd</span><span class="p">,</span>
            <span class="n">net_fwd</span><span class="p">,</span> <span class="n">net_fwd_args</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_src_memory</span> <span class="o">=</span> <span class="n">conv_internal_src_memory</span>
            <span class="o">?</span> <span class="nl">conv_internal_src_memory</span>
            <span class="p">:</span> <span class="n">conv_user_src_memory</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_weights_memory</span> <span class="o">=</span> <span class="n">conv_internal_weights_memory</span>
            <span class="o">?</span> <span class="nl">conv_internal_weights_memory</span>
            <span class="p">:</span> <span class="n">conv_user_weights_memory</span><span class="p">;</span>

    <span class="c1">// finally create a convolution primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv</span><span class="p">,</span> <span class="n">conv_pd</span><span class="p">));</span>
    <span class="n">net_fwd</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">],</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span> <span class="n">conv_src_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaf279f28c59a807e71a70c719db56c5b3"><span class="std std-ref">DNNL_ARG_WEIGHTS</span></a><span></span><span class="p">,</span>
            <span class="n">conv_weights_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad0cbc09942aba93fbe3c0c2e09166f0d"><span class="std std-ref">DNNL_ARG_BIAS</span></a><span></span><span class="p">,</span> <span class="n">conv_user_bias_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga3ca217e4a06d42a0ede3c018383c388f"><span class="std std-ref">DNNL_ARG_DST</span></a><span></span><span class="p">,</span>
            <span class="n">conv_internal_dst_memory</span><span class="p">);</span>
    <span class="n">n_fwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// AlexNet: relu</span>
    <span class="c1">// {BATCH, OC, CONV_OH, CONV_OW} -&gt; {BATCH, OC, CONV_OH, CONV_OW}</span>

    <span class="kt">float</span> <span class="n">negative_slope</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="c1">// keep memory format of source same as the format of convolution</span>
    <span class="c1">// output in order to avoid reorder</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">relu_src_md</span> <span class="o">=</span> <span class="n">conv_dst_md</span><span class="p">;</span>

    <span class="c1">// create a relu primitive descriptor</span>
    <a class="reference internal" href="struct_dnnl_eltwise_desc_t.html#doxid-structdnnl-eltwise-desc-t"><span class="std std-ref">dnnl_eltwise_desc_t</span></a><span></span> <span class="n">relu_desc</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_eltwise.html#doxid-group-dnnl-api-eltwise-1ga5606fd4c9291f7caca8b015460d2f037"><span class="std std-ref">dnnl_eltwise_forward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_prop_kind_t.html#doxid-group-dnnl-api-primitives-common-1ggae3c1f22ae55645782923fbfd8b07d0c4a6a59d07a8414bb69b3cb9904ed302adb"><span class="std std-ref">dnnl_forward</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a5e37643fec6531331e2e38df68d4c65a"><span class="std std-ref">dnnl_eltwise_relu</span></a><span></span><span class="p">,</span> <span class="n">relu_src_md</span><span class="p">,</span> <span class="n">negative_slope</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">relu_pd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">relu_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>

    <span class="c1">// create relu dst memory</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">relu_dst_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">relu_dst_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">relu_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059add5c338ad7ae0c296509e54d22130598"><span class="std std-ref">dnnl_query_dst_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">relu_dst_memory</span><span class="p">,</span> <span class="n">relu_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// finally create a relu primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">relu</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu</span><span class="p">,</span> <span class="n">relu_pd</span><span class="p">));</span>
    <span class="n">net_fwd</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">relu</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">conv_internal_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga3ca217e4a06d42a0ede3c018383c388f"><span class="std std-ref">DNNL_ARG_DST</span></a><span></span><span class="p">,</span> <span class="n">relu_dst_memory</span><span class="p">);</span>
    <span class="n">n_fwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// AlexNet: lrn</span>
    <span class="c1">// {BATCH, OC, CONV_OH, CONV_OW} -&gt; {BATCH, OC, CONV_OH, CONV_OW}</span>
    <span class="c1">// local size: 5</span>
    <span class="c1">// alpha: 0.0001</span>
    <span class="c1">// beta: 0.75</span>
    <span class="c1">// k: 1.0</span>
    <span class="kt">uint32_t</span> <span class="n">local_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0001f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.75f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>

    <span class="c1">// create lrn src memory descriptor using dst memory descriptor</span>
    <span class="c1">//  from previous primitive</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">lrn_src_md</span> <span class="o">=</span> <span class="n">relu_dst_md</span><span class="p">;</span>

    <span class="c1">// create a lrn primitive descriptor</span>
    <a class="reference internal" href="struct_dnnl_lrn_desc_t.html#doxid-structdnnl-lrn-desc-t"><span class="std std-ref">dnnl_lrn_desc_t</span></a><span></span> <span class="n">lrn_desc</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_lrn.html#doxid-group-dnnl-api-lrn-1gae124b34228f8c5adffc7733bccbf5658"><span class="std std-ref">dnnl_lrn_forward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_prop_kind_t.html#doxid-group-dnnl-api-primitives-common-1ggae3c1f22ae55645782923fbfd8b07d0c4a6a59d07a8414bb69b3cb9904ed302adb"><span class="std std-ref">dnnl_forward</span></a><span></span><span class="p">,</span>
            <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a540b116253bf1290b9536929198d18fd"><span class="std std-ref">dnnl_lrn_across_channels</span></a><span></span><span class="p">,</span> <span class="n">lrn_src_md</span><span class="p">,</span> <span class="n">local_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">k</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">lrn_pd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lrn_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>

    <span class="c1">// create primitives for lrn dst and workspace memory</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">lrn_dst_memory</span><span class="p">,</span> <span class="n">lrn_ws_memory</span><span class="p">;</span>

    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">lrn_dst_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">lrn_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059add5c338ad7ae0c296509e54d22130598"><span class="std std-ref">dnnl_query_dst_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">lrn_dst_memory</span><span class="p">,</span> <span class="n">lrn_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// create workspace only in training and only for forward primitive</span>
    <span class="c1">// query lrn_pd for workspace, this memory will be shared with forward lrn</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">lrn_ws_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">lrn_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a1c465006660aabe46e644e6df7d36e8a"><span class="std std-ref">dnnl_query_workspace_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">lrn_ws_memory</span><span class="p">,</span> <span class="n">lrn_ws_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// finally create a lrn primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">lrn</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn</span><span class="p">,</span> <span class="n">lrn_pd</span><span class="p">));</span>
    <span class="n">net_fwd</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">lrn</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span> <span class="n">relu_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga3ca217e4a06d42a0ede3c018383c388f"><span class="std std-ref">DNNL_ARG_DST</span></a><span></span><span class="p">,</span> <span class="n">lrn_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga550c80e1b9ba4f541202a7ac98be117f"><span class="std std-ref">DNNL_ARG_WORKSPACE</span></a><span></span><span class="p">,</span> <span class="n">lrn_ws_memory</span><span class="p">);</span>
    <span class="n">n_fwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// AlexNet: pool</span>
    <span class="c1">// {BATCH, OC, CONV_OH, CONV_OW} -&gt; {BATCH, OC, POOL_OH, POOL_OW}</span>
    <span class="c1">// kernel: {3, 3}</span>
    <span class="c1">// strides: {POOL_STRIDE, POOL_STRIDE}</span>
    <span class="c1">// dilation: {0, 0}</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">pool_dst_sizes</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ndims</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">pool_dst_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_dst_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">pool_kernel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">pool_strides</span> <span class="o">=</span> <span class="p">{</span><span class="n">POOL_STRIDE</span><span class="p">,</span> <span class="n">POOL_STRIDE</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">pool_padding</span> <span class="o">=</span> <span class="p">{</span><span class="n">POOL_PAD</span><span class="p">,</span> <span class="n">POOL_PAD</span><span class="p">};</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga8331e1160e52a5d4babe96736464095a"><span class="std std-ref">dnnl_dims_t</span></a><span></span> <span class="n">pool_dilation</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>

    <span class="c1">// create memory for user dst data</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_user_dst_memory</span><span class="p">;</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pool_dst_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da83a751aedeb59613312339d0f8b90f54"><span class="std std-ref">dnnl_nchw</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">net_dst</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">pool_user_dst_memory</span><span class="p">);</span>

    <span class="c1">// create a pooling primitive descriptor</span>
    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">pool_pd</span><span class="p">;</span>

    <span class="p">{</span>
        <span class="c1">// create pooling src memory descriptor using dst descriptor</span>
        <span class="c1">//  from previous primitive</span>
        <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">pool_src_md</span> <span class="o">=</span> <span class="n">lrn_dst_md</span><span class="p">;</span>

        <span class="c1">// create descriptors for dst pooling data</span>
        <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="n">pool_dst_md</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_dst_md</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">pool_dst_sizes</span><span class="p">,</span>
                <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>

        <a class="reference internal" href="struct_dnnl_pooling_v2_desc_t.html#doxid-structdnnl-pooling-v2-desc-t"><span class="std std-ref">dnnl_pooling_v2_desc_t</span></a><span></span> <span class="n">pool_desc</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_pooling_v2.html#doxid-group-dnnl-api-pooling-v2-1gadedbffa2fa02e7afdff750c9b622da86"><span class="std std-ref">dnnl_pooling_v2_forward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_prop_kind_t.html#doxid-group-dnnl-api-primitives-common-1ggae3c1f22ae55645782923fbfd8b07d0c4a6a59d07a8414bb69b3cb9904ed302adb"><span class="std std-ref">dnnl_forward</span></a><span></span><span class="p">,</span>
                <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23acf3529ba1c4761c0da90eb6750def6c7"><span class="std std-ref">dnnl_pooling_max</span></a><span></span><span class="p">,</span> <span class="n">pool_src_md</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_dst_md</span><span class="p">,</span> <span class="n">pool_strides</span><span class="p">,</span>
                <span class="n">pool_kernel</span><span class="p">,</span> <span class="n">pool_dilation</span><span class="p">,</span> <span class="n">pool_padding</span><span class="p">,</span> <span class="n">pool_padding</span><span class="p">));</span>

        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">pool_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// create memory for workspace</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_ws_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">pool_ws_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">pool_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a1c465006660aabe46e644e6df7d36e8a"><span class="std std-ref">dnnl_query_workspace_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">pool_ws_memory</span><span class="p">,</span> <span class="n">pool_ws_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// create reorder primitives between pooling dsts and user format dst</span>
    <span class="c1">// if required</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">pool_reorder_dst</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_internal_dst_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">pool_dst_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span><span class="n">pool_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059add5c338ad7ae0c296509e54d22130598"><span class="std std-ref">dnnl_query_dst_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">n_fwd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// tentative workaround: preserve space for pooling that should</span>
            <span class="c1">// happen before the reorder</span>
    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_user_dst_memory</span><span class="p">,</span> <span class="n">pool_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">pool_internal_dst_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_reorder_dst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_fwd</span><span class="p">,</span> <span class="n">net_fwd</span><span class="p">,</span>
            <span class="n">net_fwd_args</span><span class="p">));</span>
    <span class="n">n_fwd</span> <span class="o">-=</span> <span class="n">pool_reorder_dst</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_dst_memory</span> <span class="o">=</span> <span class="n">pool_internal_dst_memory</span>
            <span class="o">?</span> <span class="nl">pool_internal_dst_memory</span>
            <span class="p">:</span> <span class="n">pool_user_dst_memory</span><span class="p">;</span>

    <span class="c1">// finally create a pooling primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">pool</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool</span><span class="p">,</span> <span class="n">pool_pd</span><span class="p">));</span>
    <span class="n">net_fwd</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span> <span class="n">lrn_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga3ca217e4a06d42a0ede3c018383c388f"><span class="std std-ref">DNNL_ARG_DST</span></a><span></span><span class="p">,</span> <span class="n">pool_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">n_fwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga550c80e1b9ba4f541202a7ac98be117f"><span class="std std-ref">DNNL_ARG_WORKSPACE</span></a><span></span><span class="p">,</span> <span class="n">pool_ws_memory</span><span class="p">);</span>
    <span class="n">n_fwd</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pool_reorder_dst</span><span class="p">)</span> <span class="n">n_fwd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">//-----------------------------------------------------------------------</span>
    <span class="c1">//----------------- Backward Stream -------------------------------------</span>
    <span class="c1">//-----------------------------------------------------------------------</span>

    <span class="c1">// ... user diff_data ...</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">net_diff_dst</span>
            <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">pool_dst_sizes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="n">init_net_data</span><span class="p">(</span><span class="n">net_diff_dst</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">pool_dst_sizes</span><span class="p">);</span>

    <span class="c1">// create memory for user diff dst data</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_user_diff_dst_memory</span><span class="p">;</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">pool_dst_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da83a751aedeb59613312339d0f8b90f54"><span class="std std-ref">dnnl_nchw</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">net_diff_dst</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">pool_user_diff_dst_memory</span><span class="p">);</span>

    <span class="c1">// Pooling Backward</span>
    <span class="c1">// pooling diff src memory descriptor</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">pool_diff_src_md</span> <span class="o">=</span> <span class="n">lrn_dst_md</span><span class="p">;</span>

    <span class="c1">// pooling diff dst memory descriptor</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">pool_diff_dst_md</span> <span class="o">=</span> <span class="n">pool_dst_md</span><span class="p">;</span>

    <span class="c1">// create backward pooling descriptor</span>
    <a class="reference internal" href="struct_dnnl_pooling_v2_desc_t.html#doxid-structdnnl-pooling-v2-desc-t"><span class="std std-ref">dnnl_pooling_v2_desc_t</span></a><span></span> <span class="n">pool_bwd_desc</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_pooling_v2.html#doxid-group-dnnl-api-pooling-v2-1gacfb930c7d22ce1db2ffbca016a1c39aa"><span class="std std-ref">dnnl_pooling_v2_backward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_bwd_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23acf3529ba1c4761c0da90eb6750def6c7"><span class="std std-ref">dnnl_pooling_max</span></a><span></span><span class="p">,</span>
            <span class="n">pool_diff_src_md</span><span class="p">,</span> <span class="n">pool_diff_dst_md</span><span class="p">,</span> <span class="n">pool_strides</span><span class="p">,</span> <span class="n">pool_kernel</span><span class="p">,</span>
            <span class="n">pool_dilation</span><span class="p">,</span> <span class="n">pool_padding</span><span class="p">,</span> <span class="n">pool_padding</span><span class="p">));</span>

    <span class="c1">// backward primitive descriptor needs to hint forward descriptor</span>
    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">pool_bwd_pd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">pool_bwd_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_bwd_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">pool_pd</span><span class="p">));</span>

    <span class="c1">// create reorder primitive between user diff dst and pool diff dst</span>
    <span class="c1">// if required</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_diff_dst_memory</span><span class="p">,</span> <span class="n">pool_internal_diff_dst_memory</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">pool_reorder_diff_dst</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_user_diff_dst_memory</span><span class="p">,</span> <span class="n">pool_diff_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_internal_diff_dst_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pool_reorder_diff_dst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_bwd</span><span class="p">,</span>
            <span class="n">net_bwd</span><span class="p">,</span> <span class="n">net_bwd_args</span><span class="p">));</span>

    <span class="n">pool_diff_dst_memory</span> <span class="o">=</span> <span class="n">pool_internal_diff_dst_memory</span>
            <span class="o">?</span> <span class="nl">pool_internal_diff_dst_memory</span>
            <span class="p">:</span> <span class="n">pool_user_diff_dst_memory</span><span class="p">;</span>

    <span class="c1">// create memory for pool diff src data</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">pool_diff_src_memory</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_diff_src_memory</span><span class="p">,</span> <span class="n">pool_diff_src_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// finally create backward pooling primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">pool_bwd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">pool_bwd</span><span class="p">,</span> <span class="n">pool_bwd_pd</span><span class="p">));</span>
    <span class="n">net_bwd</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool_bwd</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac9302f4cbd2668bf9a98ba99d752b971"><span class="std std-ref">DNNL_ARG_DIFF_DST</span></a><span></span><span class="p">,</span>
            <span class="n">pool_diff_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga550c80e1b9ba4f541202a7ac98be117f"><span class="std std-ref">DNNL_ARG_WORKSPACE</span></a><span></span><span class="p">,</span> <span class="n">pool_ws_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga18ee0e360399cfe9d3b58a13dfcb9333"><span class="std std-ref">DNNL_ARG_DIFF_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">pool_diff_src_memory</span><span class="p">);</span>
    <span class="n">n_bwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// Backward lrn</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">lrn_diff_dst_md</span> <span class="o">=</span> <span class="n">pool_diff_src_md</span><span class="p">;</span>

    <span class="c1">// create backward lrn descriptor</span>
    <a class="reference internal" href="struct_dnnl_lrn_desc_t.html#doxid-structdnnl-lrn-desc-t"><span class="std std-ref">dnnl_lrn_desc_t</span></a><span></span> <span class="n">lrn_bwd_desc</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_lrn.html#doxid-group-dnnl-api-lrn-1ga954db731bb52e36319160967b29fa87f"><span class="std std-ref">dnnl_lrn_backward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn_bwd_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a540b116253bf1290b9536929198d18fd"><span class="std std-ref">dnnl_lrn_across_channels</span></a><span></span><span class="p">,</span>
            <span class="n">lrn_diff_dst_md</span><span class="p">,</span> <span class="n">lrn_src_md</span><span class="p">,</span> <span class="n">local_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">k</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">lrn_bwd_pd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">lrn_bwd_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lrn_bwd_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">lrn_pd</span><span class="p">));</span>

    <span class="c1">// create memory for lrn diff src</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">lrn_diff_src_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">lrn_diff_src_md</span> <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
            <span class="n">lrn_bwd_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a2367b043da6df5d691d6038693f363d6"><span class="std std-ref">dnnl_query_diff_src_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn_diff_src_memory</span><span class="p">,</span> <span class="n">lrn_diff_src_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// finally create backward lrn primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">lrn_bwd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">lrn_bwd</span><span class="p">,</span> <span class="n">lrn_bwd_pd</span><span class="p">));</span>
    <span class="n">net_bwd</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">lrn_bwd</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">],</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span> <span class="n">relu_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac9302f4cbd2668bf9a98ba99d752b971"><span class="std std-ref">DNNL_ARG_DIFF_DST</span></a><span></span><span class="p">,</span>
            <span class="n">pool_diff_src_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga550c80e1b9ba4f541202a7ac98be117f"><span class="std std-ref">DNNL_ARG_WORKSPACE</span></a><span></span><span class="p">,</span> <span class="n">lrn_ws_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga18ee0e360399cfe9d3b58a13dfcb9333"><span class="std std-ref">DNNL_ARG_DIFF_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">lrn_diff_src_memory</span><span class="p">);</span>
    <span class="n">n_bwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// Backward relu</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">relu_diff_dst_md</span> <span class="o">=</span> <span class="n">lrn_diff_src_md</span><span class="p">;</span>

    <span class="c1">// create backward relu descriptor</span>
    <a class="reference internal" href="struct_dnnl_eltwise_desc_t.html#doxid-structdnnl-eltwise-desc-t"><span class="std std-ref">dnnl_eltwise_desc_t</span></a><span></span> <span class="n">relu_bwd_desc</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_eltwise.html#doxid-group-dnnl-api-eltwise-1gac4fdea101041cbd8b7f99ea07a1312b7"><span class="std std-ref">dnnl_eltwise_backward_desc_init</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_bwd_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a5e37643fec6531331e2e38df68d4c65a"><span class="std std-ref">dnnl_eltwise_relu</span></a><span></span><span class="p">,</span>
            <span class="n">relu_diff_dst_md</span><span class="p">,</span> <span class="n">relu_src_md</span><span class="p">,</span> <span class="n">negative_slope</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">relu_bwd_pd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">relu_bwd_pd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">relu_bwd_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">relu_pd</span><span class="p">));</span>

    <span class="c1">// create memory for relu diff src</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">relu_diff_src_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">relu_diff_src_md</span> <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
            <span class="n">relu_bwd_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a2367b043da6df5d691d6038693f363d6"><span class="std std-ref">dnnl_query_diff_src_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_diff_src_memory</span><span class="p">,</span> <span class="n">relu_diff_src_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>

    <span class="c1">// finally create backward relu primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">relu_bwd</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_bwd</span><span class="p">,</span> <span class="n">relu_bwd_pd</span><span class="p">));</span>
    <span class="n">net_bwd</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">relu_bwd</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">conv_internal_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac9302f4cbd2668bf9a98ba99d752b971"><span class="std std-ref">DNNL_ARG_DIFF_DST</span></a><span></span><span class="p">,</span>
            <span class="n">lrn_diff_src_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga18ee0e360399cfe9d3b58a13dfcb9333"><span class="std std-ref">DNNL_ARG_DIFF_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">relu_diff_src_memory</span><span class="p">);</span>
    <span class="n">n_bwd</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// Backward convolution with respect to weights</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">conv_diff_bias_buffer</span>
            <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">conv_bias_sizes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">conv_user_diff_weights_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span>
            <span class="n">product</span><span class="p">(</span><span class="n">conv_user_weights_sizes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="c1">// initialize memory for diff weights in user format</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_user_diff_weights_memory</span><span class="p">;</span>
    <span class="n">init_data_memory</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">conv_user_weights_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da11176ff202375dcd0d06e2fba5f8a8e0"><span class="std std-ref">dnnl_oihw</span></a><span></span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <span class="n">conv_user_diff_weights_buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_user_diff_weights_memory</span><span class="p">);</span>

    <span class="c1">// create backward convolution primitive descriptor</span>
    <a class="reference internal" href="struct_dnnl_primitive_desc.html#doxid-structdnnl-primitive-desc"><span class="std std-ref">dnnl_primitive_desc_t</span></a><span></span> <span class="n">conv_bwd_weights_pd</span><span class="p">;</span>

    <span class="p">{</span>
        <span class="c1">// memory descriptors should be in format `any` to allow backward</span>
        <span class="c1">// convolution for</span>
        <span class="c1">// weights to chose the format it prefers for best performance</span>
        <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="n">conv_diff_src_md</span><span class="p">,</span> <span class="n">conv_diff_weights_md</span><span class="p">,</span>
                <span class="n">conv_diff_bias_md</span><span class="p">,</span> <span class="n">conv_diff_dst_md</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_diff_src_md</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">conv_user_src_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_diff_weights_md</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">conv_user_weights_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">conv_diff_bias_md</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">conv_bias_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091da9ccb37bb1a788f0245efbffbaf81e145"><span class="std std-ref">dnnl_x</span></a><span></span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaff696e368aeefb3036a0419c508dc6be"><span class="std std-ref">dnnl_memory_desc_init_by_tag</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_diff_dst_md</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">conv_user_dst_sizes</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_data_type_t.html#doxid-group-dnnl-api-memory-1gga012ba1c84ff24bdd068f9d2f9b26a130a6b33889946b183311c39cc1bd0656ae9"><span class="std std-ref">dnnl_f32</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_format_tag_t.html#doxid-group-dnnl-api-memory-1gga395e42b594683adb25ed2d842bb3091dafee39ac6fff0325cae43cd66495c18ac"><span class="std std-ref">dnnl_format_tag_any</span></a><span></span><span class="p">));</span>

        <span class="c1">// create backward convolution descriptor</span>
        <a class="reference internal" href="struct_dnnl_convolution_desc_t.html#doxid-structdnnl-convolution-desc-t"><span class="std std-ref">dnnl_convolution_desc_t</span></a><span></span> <span class="n">conv_bwd_weights_desc</span><span class="p">;</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_convolution.html#doxid-group-dnnl-api-convolution-1gac316460f4b2bfc654bd46504838b616c"><span class="std std-ref">dnnl_convolution_backward_weights_desc_init</span></a><span></span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">conv_bwd_weights_desc</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_alg_kind_t.html#doxid-group-dnnl-api-primitives-common-1gga96946c805f6c4922c38c37049ab95d23a8258635c519746dbf543ac13054acb5a"><span class="std std-ref">dnnl_convolution_direct</span></a><span></span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">conv_diff_src_md</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_diff_weights_md</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_diff_bias_md</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">conv_diff_dst_md</span><span class="p">,</span> <span class="n">conv_strides</span><span class="p">,</span> <span class="n">conv_padding</span><span class="p">,</span> <span class="n">conv_padding</span><span class="p">));</span>

        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga336dd467c36d8fe0d3311ddc73f239cb"><span class="std std-ref">dnnl_primitive_desc_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_bwd_weights_pd</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">conv_bwd_weights_desc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">conv_pd</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// for best performance convolution backward might chose</span>
    <span class="c1">// different memory format for src and diff_dst</span>
    <span class="c1">// than the memory formats preferred by forward convolution</span>
    <span class="c1">// for src and dst respectively</span>
    <span class="c1">// create reorder primitives for src from forward convolution to the</span>
    <span class="c1">// format chosen by backward convolution</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv_bwd_reorder_src</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_bwd_internal_src_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_diff_src_md</span> <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
            <span class="n">conv_bwd_weights_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a14a86faee7b85eeb60d0d7886756ffa5"><span class="std std-ref">dnnl_query_src_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_src_memory</span><span class="p">,</span> <span class="n">conv_diff_src_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_bwd_internal_src_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_bwd_reorder_src</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_bwd</span><span class="p">,</span>
            <span class="n">net_bwd</span><span class="p">,</span> <span class="n">net_bwd_args</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_bwd_weights_src_memory</span> <span class="o">=</span> <span class="n">conv_bwd_internal_src_memory</span>
            <span class="o">?</span> <span class="nl">conv_bwd_internal_src_memory</span>
            <span class="p">:</span> <span class="n">conv_src_memory</span><span class="p">;</span>

    <span class="c1">// create reorder primitives for diff_dst between diff_src from relu_bwd</span>
    <span class="c1">// and format preferred by conv_diff_weights</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv_reorder_diff_dst</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_internal_diff_dst_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_diff_dst_md</span> <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
            <span class="n">conv_bwd_weights_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059ae28e33688bf6c55edcf108bd24eb90de"><span class="std std-ref">dnnl_query_diff_dst_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">relu_diff_src_memory</span><span class="p">,</span> <span class="n">conv_diff_dst_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_internal_diff_dst_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_reorder_diff_dst</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_bwd</span><span class="p">,</span>
            <span class="n">net_bwd</span><span class="p">,</span> <span class="n">net_bwd_args</span><span class="p">));</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_diff_dst_memory</span> <span class="o">=</span> <span class="n">conv_internal_diff_dst_memory</span>
            <span class="o">?</span> <span class="nl">conv_internal_diff_dst_memory</span>
            <span class="p">:</span> <span class="n">relu_diff_src_memory</span><span class="p">;</span>

    <span class="c1">// create reorder primitives for conv diff weights memory</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv_reorder_diff_weights</span><span class="p">;</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_internal_diff_weights_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_diff_weights_md</span>
            <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
                    <span class="n">conv_bwd_weights_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a8551246c3e70fa1e420411507dbdfe32"><span class="std std-ref">dnnl_query_diff_weights_md</span></a><span></span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">n_bwd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// tentative workaround: preserve space for conv_bwd_weights</span>
            <span class="c1">// that should happen before the reorder</span>

    <span class="n">CHECK</span><span class="p">(</span><span class="n">prepare_reorder</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_user_diff_weights_memory</span><span class="p">,</span> <span class="n">conv_diff_weights_md</span><span class="p">,</span>
            <span class="n">engine</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conv_internal_diff_weights_memory</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">conv_reorder_diff_weights</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n_bwd</span><span class="p">,</span> <span class="n">net_bwd</span><span class="p">,</span> <span class="n">net_bwd_args</span><span class="p">));</span>
    <span class="n">n_bwd</span> <span class="o">-=</span> <span class="n">conv_reorder_diff_weights</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_diff_weights_memory</span> <span class="o">=</span> <span class="n">conv_internal_diff_weights_memory</span>
            <span class="o">?</span> <span class="nl">conv_internal_diff_weights_memory</span>
            <span class="p">:</span> <span class="n">conv_user_diff_weights_memory</span><span class="p">;</span>

    <span class="c1">// create memory for diff bias memory</span>
    <a class="reference internal" href="struct_dnnl_memory.html#doxid-structdnnl-memory"><span class="std std-ref">dnnl_memory_t</span></a><span></span> <span class="n">conv_diff_bias_memory</span><span class="p">;</span>
    <span class="k">const</span> <a class="reference internal" href="struct_dnnl_memory_desc_t.html#doxid-structdnnl-memory-desc-t"><span class="std std-ref">dnnl_memory_desc_t</span></a><span></span> <span class="o">*</span><span class="n">conv_diff_bias_md</span> <span class="o">=</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga416464a8b3e898d8965a5f3c49d4cd54"><span class="std std-ref">dnnl_primitive_desc_query_md</span></a><span></span><span class="p">(</span>
            <span class="n">conv_bwd_weights_pd</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_query_t.html#doxid-group-dnnl-api-primitives-common-1gga9e5235563cf7cfc10fa89f415de98059a8551246c3e70fa1e420411507dbdfe32"><span class="std std-ref">dnnl_query_diff_weights_md</span></a><span></span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga52a9246bd7f4e498b08d61e75e689a0c"><span class="std std-ref">dnnl_memory_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_diff_bias_memory</span><span class="p">,</span> <span class="n">conv_diff_bias_md</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span>
            <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaf19cbfbf1f0a9508283f2a25561ae0e4"><span class="std std-ref">DNNL_MEMORY_ALLOCATE</span></a><span></span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga6888f8c17f272d6729c9bc258ed41fcf"><span class="std std-ref">dnnl_memory_set_data_handle</span></a><span></span><span class="p">(</span>
            <span class="n">conv_diff_bias_memory</span><span class="p">,</span> <span class="n">conv_diff_bias_buffer</span><span class="p">));</span>

    <span class="c1">// finally created backward convolution weights primitive</span>
    <a class="reference internal" href="struct_dnnl_primitive.html#doxid-structdnnl-primitive"><span class="std std-ref">dnnl_primitive_t</span></a><span></span> <span class="n">conv_bwd_weights</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gad07540a0074d9cd3a6970b49897e57d3"><span class="std std-ref">dnnl_primitive_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">conv_bwd_weights</span><span class="p">,</span> <span class="n">conv_bwd_weights_pd</span><span class="p">));</span>
    <span class="n">net_bwd</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_bwd_weights</span><span class="p">;</span>
    <span class="n">prepare_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">],</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac37ad67b48edeb9e742af0e50b70fe09"><span class="std std-ref">DNNL_ARG_SRC</span></a><span></span><span class="p">,</span>
            <span class="n">conv_bwd_weights_src_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gac9302f4cbd2668bf9a98ba99d752b971"><span class="std std-ref">DNNL_ARG_DIFF_DST</span></a><span></span><span class="p">,</span>
            <span class="n">conv_diff_dst_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga3324092ef421f77aebee83b0117cac60"><span class="std std-ref">DNNL_ARG_DIFF_WEIGHTS</span></a><span></span><span class="p">,</span>
            <span class="n">conv_diff_weights_memory</span><span class="p">);</span>
    <span class="n">set_arg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">n_bwd</span><span class="p">].</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga1cd79979dda6df65ec45eef32a839901"><span class="std std-ref">DNNL_ARG_DIFF_BIAS</span></a><span></span><span class="p">,</span>
            <span class="n">conv_diff_bias_memory</span><span class="p">);</span>
    <span class="n">n_bwd</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">conv_reorder_diff_weights</span><span class="p">)</span> <span class="n">n_bwd</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// output from backward stream</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">net_diff_weights</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">net_diff_bias</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// number of iterations for training.</span>
    <a class="reference internal" href="struct_dnnl_stream.html#doxid-structdnnl-stream"><span class="std std-ref">dnnl_stream_t</span></a><span></span> <span class="n">stream</span><span class="p">;</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_stream.html#doxid-group-dnnl-api-stream-1gaefca700bdec59b22c05f248df5bb3354"><span class="std std-ref">dnnl_stream_create</span></a><span></span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <a class="reference internal" href="enum_dnnl_stream_flags_t.html#doxid-group-dnnl-api-stream-1gga3d74cfed8fe92b0e4498a1f2bdab5547acf05c543bccebd58e6d4e0db7137fb92"><span class="std std-ref">dnnl_stream_default_flags</span></a><span></span><span class="p">));</span>
    <span class="c1">// Execute the net</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_iter</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_fwd</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga57f8ec3a6e5b33a1068cf2236028935c"><span class="std std-ref">dnnl_primitive_execute</span></a><span></span><span class="p">(</span><span class="n">net_fwd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span>
                    <span class="n">net_fwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nargs</span><span class="p">,</span> <span class="n">net_fwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">args</span><span class="p">));</span>

        <span class="c1">// Update net_diff_dst</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">net_output</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="c1">// output from forward stream:</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga71efa7bd0ac194fdec98fb908b8ba9c5"><span class="std std-ref">dnnl_memory_get_data_handle</span></a><span></span><span class="p">(</span><span class="n">pool_user_dst_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">net_output</span><span class="p">));</span>
        <span class="c1">// ...user updates net_diff_dst using net_output...</span>
        <span class="c1">// some user defined func update_diff_dst(net_diff_dst, net_output)</span>

        <span class="c1">// Backward pass</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_bwd</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga57f8ec3a6e5b33a1068cf2236028935c"><span class="std std-ref">dnnl_primitive_execute</span></a><span></span><span class="p">(</span><span class="n">net_bwd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stream</span><span class="p">,</span>
                    <span class="n">net_bwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nargs</span><span class="p">,</span> <span class="n">net_bwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">args</span><span class="p">));</span>

        <span class="c1">// ... update weights ...</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga71efa7bd0ac194fdec98fb908b8ba9c5"><span class="std std-ref">dnnl_memory_get_data_handle</span></a><span></span><span class="p">(</span>
                <span class="n">conv_user_diff_weights_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">net_diff_weights</span><span class="p">));</span>
        <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1ga71efa7bd0ac194fdec98fb908b8ba9c5"><span class="std std-ref">dnnl_memory_get_data_handle</span></a><span></span><span class="p">(</span>
                <span class="n">conv_diff_bias_memory</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">net_diff_bias</span><span class="p">));</span>
        <span class="c1">// ...user updates weights and bias using diff weights and bias...</span>
        <span class="c1">// some user defined func update_weights(conv_user_weights_memory,</span>
        <span class="c1">// conv_bias_memory,</span>
        <span class="c1">//      net_diff_weights, net_diff_bias);</span>
    <span class="p">}</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_stream.html#doxid-group-dnnl-api-stream-1ga6a8175b9384349b1ee73a78a24b5883f"><span class="std std-ref">dnnl_stream_wait</span></a><span></span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>

    <a class="reference internal" href="group_dnnl_api_stream.html#doxid-group-dnnl-api-stream-1gae7fe8b23136cafa62a39301799cd6e44"><span class="std std-ref">dnnl_stream_destroy</span></a><span></span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>

    <span class="c1">// clean up nets</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_fwd</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">free_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_fwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_bwd</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">free_arg_node</span><span class="p">(</span><span class="o">&amp;</span><span class="n">net_bwd_args</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="c1">// Cleanup forward</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">relu_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_pd</span><span class="p">));</span>

    <span class="n">free</span><span class="p">(</span><span class="n">net_src</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">net_dst</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_user_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_user_weights_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_user_bias_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_internal_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_internal_weights_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_internal_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_reorder_src</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_reorder_weights</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">conv_weights</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">conv_bias</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">relu_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">relu</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_ws_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_user_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_internal_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_ws_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_reorder_dst</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">pool</span><span class="p">);</span>

    <span class="c1">// Cleanup backward</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_bwd_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_bwd_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">relu_bwd_pd</span><span class="p">));</span>
    <span class="n">CHECK</span><span class="p">(</span><a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1ga643938c7c73d200ac1fd3866204e7285"><span class="std std-ref">dnnl_primitive_desc_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_bwd_weights_pd</span><span class="p">));</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_user_diff_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_diff_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_internal_diff_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_reorder_diff_dst</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">pool_bwd</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">net_diff_dst</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_diff_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">lrn_bwd</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">relu_diff_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">relu_bwd</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_user_diff_weights_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_diff_bias_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_bwd_internal_src_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_bwd_reorder_src</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_internal_diff_dst_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_reorder_diff_dst</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_memory.html#doxid-group-dnnl-api-memory-1gaa219225aae8e53489caab3fe1bc80a52"><span class="std std-ref">dnnl_memory_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_internal_diff_weights_memory</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_reorder_diff_weights</span><span class="p">);</span>
    <a class="reference internal" href="group_dnnl_api_primitives_common.html#doxid-group-dnnl-api-primitives-common-1gaba605c4591c2054a6ee80ec1b581659f"><span class="std std-ref">dnnl_primitive_destroy</span></a><span></span><span class="p">(</span><span class="n">conv_bwd_weights</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">conv_diff_bias_buffer</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">conv_user_diff_weights_buffer</span><span class="p">);</span>

    <a class="reference internal" href="group_dnnl_api_engine.html#doxid-group-dnnl-api-engine-1ga8d6976b3792cf1ef64d01545929b4d8f"><span class="std std-ref">dnnl_engine_destroy</span></a><span></span><span class="p">(</span><span class="n">engine</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">simple_net</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Example passed on CPU.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></pre>
</section>


              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Intel<br/>
        
            &copy; Copyright  Copyright 2016 - 2021, Intel Corporation.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>